{{
   config(
     materialized='view'
   )
}}

SELECT ID::number as ID,
       TO_TIMESTAMP_NTZ(UPDATED_TIME, 'YYYY-MM-DD"T"HH24:MI:SSTZHTZM') as UPDATED_TIME,
       CAMPAIGN_ID::number as CAMPAIGN_ID,
       ACCOUNT_ID::number as ACCOUNT_ID,
       ASSET_FEED_ID::number as ASSET_FEED_ID,
       BID_AMOUNT::number as BID_AMOUNT,
       BID_STRATEGY,
       BILLING_EVENT,
       BUDGET_REMAINING::number as BUDGET_REMAINING,
       CONFIGURED_STATUS,
       TO_TIMESTAMP_NTZ(CREATED_TIME, 'YYYY-MM-DD"T"HH24:MI:SSTZHTZM') as CREATED_TIME,
       DAILY_BUDGET::number as DAILY_BUDGET,
       DAILY_MIN_SPEND_TARGET::number as DAILY_MIN_SPEND_TARGET,
       DAILY_SPEND_CAP::number as DAILY_SPEND_CAP,
       DESTINATION_TYPE,
       EFFECTIVE_STATUS,
       TO_TIMESTAMP_NTZ(END_TIME, 'YYYY-MM-DD"T"HH24:MI:SSTZHTZM') as END_TIME,
       INSTAGRAM_ACTOR_ID::number as INSTAGRAM_ACTOR_ID,
       IS_DYNAMIC_CREATIVE::boolean as IS_DYNAMIC_CREATIVE,
       LIFETIME_BUDGET::number as LIFETIME_BUDGET,
       LIFETIME_IMPS::number as LIFETIME_IMPS,
       LIFETIME_MIN_SPEND_TARGET::number as LIFETIME_MIN_SPEND_TARGET,
       LIFETIME_SPEND_CAP::number as LIFETIME_SPEND_CAP,
       MULTI_OPTIMIZATION_GOAL_WEIGHT,
       NAME,
       OPTIMIZATION_GOAL,
       OPTIMIZATION_SUB_EVENT,
       RECURRING_BUDGET_SEMANTICS::boolean as RECURRING_BUDGET_SEMANTICS,
       REVIEW_FEEDBACK,
       RF_PREDICTION_ID,
       STATUS,
       TO_TIMESTAMP_NTZ(START_TIME, 'YYYY-MM-DD"T"HH24:MI:SSTZHTZM') as START_TIME,
       USE_NEW_APP_CLICK::boolean as USE_NEW_APP_CLICK,
       PROMOTED_OBJECT_APPLICATION_ID,
       PROMOTED_OBJECT_CUSTOM_CONVERSION_ID::number as PROMOTED_OBJECT_CUSTOM_CONVERSION_ID,
       PROMOTED_OBJECT_CUSTOM_EVENT_STR,
       PROMOTED_OBJECT:custom_event_type::varchar as PROMOTED_OBJECT_CUSTOM_EVENT_TYPE,
       PROMOTED_OBJECT_EVENT_ID::number as PROMOTED_OBJECT_EVENT_ID,
       PROMOTED_OBJECT_OBJECT_STORE_URL,
       PROMOTED_OBJECT_OFFER_ID::number as PROMOTED_OBJECT_OFFER_ID,
       PROMOTED_OBJECT_OFFLINE_CONVERSION_DATA_SET_ID::number as PROMOTED_OBJECT_OFFLINE_CONVERSION_DATA_SET_ID,
       PROMOTED_OBJECT_PAGE_ID::number as PROMOTED_OBJECT_PAGE_ID,
       PROMOTED_OBJECT_PIXEL_AGGREGATION_RULE,
       PROMOTED_OBJECT:pixel_id::number as PROMOTED_OBJECT_PIXEL_ID,
       PROMOTED_OBJECT_PIXEL_RULE,
       PROMOTED_OBJECT_PLACE_PAGE_SET_ID::number as PROMOTED_OBJECT_PLACE_PAGE_SET_ID,
       PROMOTED_OBJECT_PRODUCT_CATALOG_ID::number as PROMOTED_OBJECT_PRODUCT_CATALOG_ID,
       PROMOTED_OBJECT_PRODUCT_SET_ID::number as PROMOTED_OBJECT_PRODUCT_SET_ID,
       PROMOTED_OBJECT_RETENTION_DAYS,
       LEARNING_STAGE_INFO:attribution_windows as LEARNING_STAGE_INFO_ATTRIBUTION_WINDOWS,
       LEARNING_STAGE_INFO:conversions::number as LEARNING_STAGE_INFO_CONVERSIONS,
       LEARNING_STAGE_INFO:last_sig_edit_ts::number as LEARNING_STAGE_INFO_LAST_SIG_EDIT_TS,
       LEARNING_STAGE_INFO:status::varchar as LEARNING_STAGE_INFO_STATUS,
       TARGETING_APP_INSTALL_STATE,
       TARGETING:age_max::number as TARGETING_AGE_MAX,
       TARGETING:age_min::number as TARGETING_AGE_MIN,
       TARGETING:genders as TARGETING_GENDERS,
       TARGETING_BEHAVIORS,
       TARGETING_INTERESTS,
       TARGETING_RELATIONSHIP_STATUSES,
       TARGETING_LIFE_EVENTS,
       TARGETING_INDUSTRIES,
       TARGETING_INCOME,
       TARGETING_FAMILY_STATUSES,
       TARGETING_AUDIENCE_NETWORK_POSITIONS,
       TARGETING_CONNECTIONS,
       TARGETING:device_platforms as TARGETING_DEVICE_PLATFORMS,
       TARGETING_EFFECTIVE_AUDIENCE_NETWORK_POSITIONS,
       TARGETING_EXCLUDED_CONNECTIONS,
       TARGETING_EXCLUDED_PUBLISHER_CATEGORIES,
       TARGETING_EXCLUDED_PUBLISHER_LIST_IDS,
       TARGETING_EXCLUDED_USER_DEVICE,
       TARGETING:facebook_positions as TARGETING_FACEBOOK_POSITIONS,
       TARGETING_FRIENDS_OF_CONNECTIONS,
       TARGETING:instagram_positions as TARGETING_INSTAGRAM_POSITIONS,
       TARGETING:publisher_platforms as TARGETING_PUBLISHER_PLATFORMS,
       TARGETING_USER_OS,
       TARGETING_USER_DEVICE,
       TARGETING_WIRELESS_CARRIER,
       TARGETING_EDUCATION_SCHOOLS,
       TARGETING_EDUCATION_STATUSES,
       TARGETING_COLLEGE_YEARS,
       TARGETING_EDUCATION_MAJORS,
       TARGETING_WORK_EMPLOYERS,
       TARGETING_WORK_POSITIONS,
       TARGETING_LOCALES,
       TARGETING_USER_ADCLUSTERS,
       TARGETING_FLEXIBLE_SPEC,
       TARGETING_EXCLUSIONS,
       TARGETING:geo_locations.countries as TARGETING_GEO_LOCATIONS_COUNTRIES,
       TARGETING_GEO_LOCATIONS_REGIONS,
       TARGETING_GEO_LOCATIONS_CITIES,
       TARGETING_GEO_LOCATIONS_ZIPS,
       TARGETING_GEO_LOCATIONS_PLACES,
       TARGETING_GEO_LOCATIONS_CUSTOM_LOCATIONS,
       TARGETING_GEO_LOCATIONS_GEO_MARKETS,
       TARGETING_GEO_LOCATIONS_ELECTORAL_DISTRICT,
       TARGETING:geo_locations.location_types as TARGETING_GEO_LOCATIONS_LOCATION_TYPES,
       TARGETING_GEO_LOCATIONS_COUNTRY_GROUPS,
       TARGETING_EXCLUDED_GEO_LOCATIONS_COUNTRIES,
       TARGETING_EXCLUDED_GEO_LOCATIONS_REGIONS,
       TARGETING_EXCLUDED_GEO_LOCATIONS_CITIES,
       TARGETING_EXCLUDED_GEO_LOCATIONS_ZIPS,
       TARGETING_EXCLUDED_GEO_LOCATIONS_PLACES,
       TARGETING_EXCLUDED_GEO_LOCATIONS_CUSTOM_LOCATIONS,
       TARGETING_EXCLUDED_GEO_LOCATIONS_GEO_MARKETS,
       TARGETING_EXCLUDED_GEO_LOCATIONS_ELECTORAL_DISTRICT,
       TARGETING_EXCLUDED_GEO_LOCATIONS_LOCATION_TYPES,
       TARGETING_EXCLUDED_GEO_LOCATIONS_COUNTRY_GROUPS,

       SOURCE_ADSET_ID::number as ADSET_SOURCE_ID,
       BID_AMOUNT::number as BID_INFO_ACTIONS,
       BID_INFO:IMPRESSIONS::number as BID_INFO_IMPRESSIONS,
       _SDC_BATCHED_AT

FROM {{ source('tap_facebook', 'adsets') }} as meltano_ad_set_history
